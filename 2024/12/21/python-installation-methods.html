<!DOCTYPE html>
<html lang="en" class="min-h-screen">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Program Distribution and Installation Methods | Server As Code Dot Com</title>
    <meta name="description" content="A techno-blog for our techno-times">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/prism.min.css" rel="stylesheet">
    <link href="/assets/css/extra.css" rel="stylesheet">

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/img/favicon/site.webmanifest">
    <link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <meta name="twitter:site" content="serverascode.com">
    <meta name="twitter:creator" content="Curtis Collicutt">
    
    
        <meta name="twitter:title" content="Python Program Distribution and Installation Methods">
        
        <meta name="twitter:description" content="
    
    üêç tldr; There are many methods to distribute and install Python programs. Here are some of the ways I've tinkered with recently. Recommendation: in...">
        <meta property="og:description" content="
    
    üêç tldr; There are many methods to distribute and install Python programs. Here are some of the ways I've tinkered with recently. Recommendation: in..." />
        
        <meta property="og:title" content="Python Program Distribution and Installation Methods" />
        <meta property="og:type" content="article" />
    
    
    
    
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://serverascode.com/img/social/posts/python-installation-methods.png">
    <meta property="og:image" content="https://serverascode.com/img/social/posts/python-installation-methods.png" />
    
    
    <meta property="og:url" content="https://serverascode.com/2024/12/21/python-installation-methods.html" />
    <meta property="og:site_name" content="Server As Code Dot Com" />
</head>
<body class="font-sans">
    <div class="magazine-container">
        <header>
            <div class="magazine-header">
                <div class="issue-number-dropdown">
                    <button class="issue-number-top dropdown-toggle">
                        ISSUE 259
                        <span class="arrow-down"></span>
                    </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-section">
                            <h3>Navigation</h3>
                            <a href="/">Home</a>
                            <a href="/archive.html">Archive</a>
                            <a href="/feed.xml">RSS Feed</a>
                        </div>
                        <div class="dropdown-section">
                            <h3>Sections</h3>
                            <a href="/#latest-issues">Latest Issues</a>
                            <a href="/#tidal-series">Tidal Series</a>
                            <a href="/#connect-with-me">Connect With Me</a>
                            <a href="/#recent-posts">Recent Posts</a>
                        </div>
                        <div class="dropdown-section">
                            <h3>Connect</h3>
                            
                                
                            
                                
                                    <a href="https://tidalseries.com" target="_blank" rel="noopener noreferrer">TIDAL SERIES Newsletter</a>
                                
                            
                                
                                    <a href="https://www.linkedin.com/in/ccollicutt/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
                                
                            
                                
                                    <a href="https://taico.ca" target="_blank" rel="noopener noreferrer">TAICO - The Toronto AI and Cybersecurity Organization</a>
                                
                            
                                
                                    <a href="https://github.com/ccollicutt" target="_blank" rel="noopener noreferrer">GitHub</a>
                                
                            
                                
                                    <a href="https://huggingface.co/ccollicutt" target="_blank" rel="noopener noreferrer">Hugging Face</a>
                                
                            
                                
                            
                        </div>
                    </div>
                </div>
                <div class="magazine-info">
                    <div>Server As Code Dot Com</div>
                    <div class="underline"><a href="/archive.html">ARCHIVE</a></div>
                    <div class="underline">2025 FEBRUARY</div>
                    <div class="underline">¬•980</div>
                </div>
            </div>
            <p class="magazine-subtitle">A techno-blog for our techno-times</p>
            <a href="/" class="logo-link">
                <img src="/img/logo/logo.png" alt="Server As Code Dot Com" class="logo-image">
            </a>
        </header>

        <div class="content-wrapper">
            <main class="flex-grow px-4 md:px-8 main-content">
                <div class="max-w-4xl mx-auto px-4 mt-8 mb-12">
    <div class="flex justify-center space-x-4">
        
        
        <a href="https://serverascode.com" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/author/curtis.jpg" alt="Curtis Collicutt" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">Curtis Collicutt</span>
        </a>
        
        
        
        <a href="https://tidalseries.com" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/tidalseries.png" alt="TIDAL SERIES Newsletter" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">TIDAL SERIES Newsletter</span>
        </a>
        
        
        
        <a href="https://www.linkedin.com/in/ccollicutt/" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/linkedin.png" alt="LinkedIn" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">LinkedIn</span>
        </a>
        
        
        
        
        
        <a href="https://github.com/ccollicutt" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/github.jpg" alt="GitHub" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">GitHub</span>
        </a>
        
        
        
        
        
        
    </div>
</div>

<article class="prose lg:prose-xl mx-auto">
    <header class="mb-8 text-center not-prose">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-2">Python Program Distribution and Installation Methods</h1>
        <p class="text-gray-600">
            <time datetime="2024-12-21T00:00:00-05:00">
                December 21, 2024
            </time>
            
        </p>
    </header>

    <div id="toc" class="hidden mb-8 p-4 bg-gray-50 rounded-lg not-prose">
        <h2 class="text-lg font-semibold mb-2">Table of Contents</h2>
        <nav id="toc-content"></nav>
    </div>

    

    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
    <img src="/img/magazine-cards/python-install-distribute-200w.png" alt="Tailscale Mullvad" style="max-width: 200px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);" />
    <p><em>üêç tldr; There are many methods to distribute and install Python programs. Here are some of the ways I've tinkered with recently. Recommendation: in most cases, use pipx. üîß</em></p>
</div>

<hr />

<div class="disclaimer" style="background-color: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin: 20px 0;">
    <p style="margin: 0;"><span style="font-size: 1.2em;">‚ö†Ô∏è</span> <strong>Disclaimer:</strong> I'm not a Python expert, I've just been writing more Python lately and trying to figure out how best to distribute it. There are several fascinating and useful ways to distribute Python programs, and I've tried a few of them, some successfully, some not so much.</p>
</div>

<h2 id="introduction">Introduction</h2>

<p>I like Python. I‚Äôm not sure why‚Ä¶maybe because it seems the closest programming language to English, or maybe because it‚Äôs so flexible that you can be messy with it. A lot of people dislike it because it‚Äôs not typed, and because you can be messy with it‚Äìone can write some pretty unstructured Python code. Also, it doesn‚Äôt compile into a single binary. I think that is part of the reason why Go has gained a lot of traction, and now, in a similar vein, we have Rust too. Another problem is that you have to deal with Python versions on the machine where the application is installed. It might be nice to distribute the Python runtime with the application.</p>

<p>So, problems to solve with distributing Python programs, at least by default:</p>

<ol>
  <li>You don‚Äôt have a single binary‚Ä¶.instead you have an entrypoint into a bunch of Python code and dependencies</li>
  <li>You don‚Äôt have a single Python version embedded‚Ä¶you have to deal with all kinds of different system versions</li>
  <li>You typically have a lot of dependencies, Python has a lot of great libraries to take advantage of</li>
  <li>Some dependencies need to be compiled, netifaces as an example, so sometimes you might need a massive toolchain to build them, which makes the user experience a bit more complex (though Python Wheels help with this)</li>
</ol>

<p>This led me to try a few different ways to distribute Python programs that might help with these problems. So far there have been five or so ways I‚Äôve tinkered with to distribute Python programs.</p>

<ol>
  <li>AppImage - <em>NOTE: Didn‚Äôt get this working</em></li>
  <li>PyInstaller - <em>This did work and created a nice binary</em></li>
  <li>Pip</li>
  <li>Installer script</li>
  <li>Pipx - <em>Probably the best choice for most situations</em></li>
</ol>

<h2 id="installation-and-distribution-methods">Installation and Distribution Methods</h2>

<h3 id="appimage">AppImage</h3>

<p><a href="https://appimage.org/">AppImage</a> is a very interesting idea, but I couldn‚Äôt get it working with my Python application.</p>

<p>From the AppImage website:</p>

<blockquote>
  <p>‚ÄúAs a user, I want to download an application from the original author, and run it on my Linux desktop system just like I would do with a Windows or Mac application.‚Äù</p>
</blockquote>

<blockquote>
  <p>‚ÄúAs an application author, I want to provide packages for Linux desktop systems, without the need to get it ‚Äòinto‚Äô a distribution and without having to build for gazillions of different distributions.‚Äù</p>
</blockquote>

<p>I tinkered with AppImage for a while, but ended up just using PyInstaller. AppImage can package anything, whereas something like PyInstaller is more specific to Python applications. I think this is what tripped me up.</p>

<p>I‚Äôll come back to AppImage later as I think it‚Äôs a great idea, and I have applications I use which are distributed as AppImages‚Äìjust download, mark as executable and run, all in one file.</p>

<h3 id="pyinstaller">PyInstaller</h3>

<blockquote>
  <p>PyInstaller bundles a Python application and all its dependencies into a single package. The user can run the packaged app without installing a Python interpreter or any modules. PyInstaller supports Python 3.8 and newer, and correctly bundles many major Python packages such as numpy, matplotlib, PyQt, wxPython, and others. - <a href="https://pyinstaller.org/en/stable/">PyInstaller</a></p>
</blockquote>

<p>There are a few ways to get a binary out of a Python program. PyInstaller is one of them, and this is the method that seems to work best for me.</p>

<p>Here I build a nice single binary that I can distribute.</p>

<pre><code class="language-bash">pyinstaller \
            --clean \
            --onefile \
            --name coolprog \
            --workpath pyinstaller-build \
            --distpath dist \
            --hidden-import yaml \
            --hidden-import netifaces \
            --hidden-import redis \
            --hidden-import coolprog.cli \
            src/coolprog_main.py
</code></pre>

<p>This created a nice relatively small binary.</p>

<pre><code class="language-bash">du -hsc dist/coolprog
16M	dist/coolprog
16M	total
</code></pre>

<p>All you have to do is distribute the binary! Having a single binary that works, that contains the Python runtime is amazing and feels like magic.</p>

<p>One issue that I have is that apparently sometimes you have to give it some hints regarding the dependencies, e.g. <code>--hidden-import</code>. I‚Äôm not clear on how you would know what hints to give.</p>

<p>Benefits:</p>

<ul>
  <li>Everything in one binary</li>
  <li>This includes the Python runtime as well!</li>
  <li>And all the application dependencies</li>
</ul>

<h3 id="pip">Pip</h3>

<p>Pip is the Python package manager. It‚Äôs what you typically use to install Python packages. If you‚Äôve used Python, you‚Äôve probably used pip.</p>

<p>A few points:</p>

<ul>
  <li>pip installs your application and dependencies from pypi.org</li>
  <li>Anyone (yes anyone) can sign up for a PyPI account and upload their own packages (which is amazing in itself!)</li>
  <li>There is also a test PyPI server, which is useful for testing</li>
</ul>

<p>Once you‚Äôve signed up for a PyPI account, setup your application, you can simply upload it to PyPI with something like twine, and then once it is uploaded, you can install it with pip.</p>

<pre><code class="language-bash">pip install coolprog
</code></pre>

<p>However, in modern Linux distributions, you will get this kind of message:</p>

<pre><code class="language-bash">ubuntu@coolprog-test:~$ pip install coolprog
error: externally-managed-environment

√ó This environment is externally managed
‚ï∞‚îÄ&gt; To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Debian-packaged Python package,
    create a virtual environment using python3 -m venv path/to/venv.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
    sure you have python3-full installed.
    
    If you wish to install a non-Debian packaged Python application,
    it may be easiest to use pipx install xyz, which will manage a
    virtual environment for you. Make sure you have pipx installed.
    
    See /usr/share/doc/python3.12/README.venv for more information.

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
</code></pre>

<p>With this in mind, you will likely want to use pipx instead of pip as you don‚Äôt want to mess with the system Python, say for example by breaking it during the installation of your application. That would not make you unpopular and would provide a poor user experience.</p>

<h3 id="pipx">Pipx</h3>

<p><a href="https://github.com/pypa/pipx">Pipx</a> is a tool for installing and running Python applications in isolated environments. It‚Äôs like pip but specifically for Python applications rather than libraries.</p>

<p>The key benefits of pipx are:</p>

<ol>
  <li>It installs each application in its own isolated virtual environment, preventing dependency conflicts between different applications</li>
  <li>It makes Python applications available globally on your system while keeping their dependencies contained</li>
  <li>It‚Äôs easy to install, upgrade, and uninstall applications without affecting other Python tools</li>
</ol>

<div style="background-color: #f0f7fb; border-left: solid 4px #3498db; margin: 12px 0; padding: 12px;">
<p><strong>Nice feature:</strong> Pipx provides a clean installation experience - you don't get a big stream of text output showing the tens of complex dependencies that are being installed.</p>
</div>

<p>Here is an example of installing a Python application with pipx:</p>

<pre><code class="language-bash">pipx install coolprog
</code></pre>

<p>e.g. output:</p>

<pre><code class="language-bash">ubuntu@coolprog-test:~$ pipx install coolprog
  installed package coolprog 0.2.0, installed using Python 3.12.3
  These apps are now globally available
    - coolprog
‚ö†Ô∏è  Note: '/home/ubuntu/.local/bin' is not on your PATH environment variable. These apps will
    not be globally accessible until your PATH is updated. Run `pipx ensurepath` to
    automatically add it, or manually modify your PATH in your shell's config file (i.e.
    ~/.bashrc).
done! ‚ú® üåü ‚ú®
</code></pre>

<p>So, just add it to your path and you‚Äôre good to go.</p>

<pre><code class="language-bash">ubuntu@coolprog-test:~$ pipx ensurepath
Success! Added /home/ubuntu/.local/bin to the PATH environment variable.

Consider adding shell completions for pipx. Run 'pipx completions' for instructions.

You will need to open a new terminal or re-login for the PATH changes to take effect.

Otherwise pipx is ready to go! ‚ú® üåü ‚ú®
</code></pre>

<p>Nice!</p>

<h3 id="installer-script">Installer Script</h3>

<p>Working with installer scripts was my first approach before moving to PyInstaller or pipx. The classic <code>curl | bash</code> installation method, while discouraged for security reasons, offers simplicity that some people appreciate. The challenge lies in creating an installer script that provides both convenience and a great user experience. You need to consider how the installation impacts the user‚Äôs system‚Äìwhat gets installed where, and how it interacts with existing components, etc., etc.</p>

<p>In the script I eventually settled on installing the application in its own Python virtual environment, which ironically ended up being quite similar to pipx‚Äôs approach. This makes sense, as isolated environments help avoid dependency conflicts while maintaining a clean, manageable installation. Sure you have a bit more complexity in the number of virtual environments you have to manage, but if there is an abstraction managing it, e.g. pipx, then it‚Äôs doable.</p>

<p>In the end, an installer script might make sense, but if pipx will work, it may be best to simply use pipx.</p>

<h3 id="other-methods">Other Methods</h3>

<p>I didn‚Äôt try any of these, but some other methods I‚Äôve seen:</p>

<ul>
  <li>Cx_Freeze</li>
  <li>Flatpak</li>
  <li>Py2Exe</li>
  <li>bbfreeze</li>
  <li>py2app</li>
  <li>PyOxidizer???</li>
  <li>Nuitka???</li>
  <li>Docker</li>
  <li>Shiv</li>
  <li>Pipenv</li>
</ul>

<h2 id="and-probably-many-more-some-of-which-are-new-and-some-of-which-are-getting-long-in-the-tooth">And probably many more, some of which are new, and some of which are getting long in the tooth.</h2>
<h2 id="conclusion">Conclusion</h2>

<p>Distributing Python applications isn‚Äôt easy. You are installing something into someone‚Äôs computer, or server, and you have to make sure it works, that it isn‚Äôt going to break their system or their Python environment, and that it is as easy as possible to install. But doing all that is more difficult than it sounds. Though, having now discovered pipx, I think it is the best choice for most situations.</p>

<p>I find all the work outside of writing code for an application to be much, much more complex than writing the code itself, and I‚Äôve written about it <a href="/2024-10-25-pain-of-programming.html">here</a>.</p>

<div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
    <img src="/img/magazine-cards/thousand-cuts-200w.png" alt="Death by a Thousand Cuts" style="max-width: 200px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);" />
    <p><em>ü§î Related: Check out my post about <a href="https://serverascode.com/2024/10/25/pain-of-programming.html">the pain points in programming</a> beyond just writing code. üòÖ</em></p>
</div>


</article>
            </main>

            <footer class="mt-12 py-4 text-center text-xs text-gray-500 border-t font-light">
                <p>&copy; 2025 Server As Code Dot Com. All rights reserved.</p>
            </footer>

            <div class="issue-number-large">
                259
            </div>
        </div>
    </div>

<!-- Prism.js for syntax highlighting -->
<script src="/assets/js/prism.min.js"></script>
<script>
    // This script should be placed after the Prism.js script
    if (Prism.plugins && Prism.plugins.NormalizeWhitespace) {
        Prism.plugins.NormalizeWhitespace.setDefaults({
            'remove-trailing': true,
            'remove-indent': true,
            'left-trim': true,
            'right-trim': true
        });
    }

    // NOTE(curtis): None of the ``` in my posts had a language specified, so I'm setting it to bash by default
    Prism.highlightAll = (function (originalHighlightAll) {
        return function () {
            // For block code
            document.querySelectorAll('pre code:not([class*="language-"])')
                .forEach(function(element) {
                    element.classList.add('language-bash');
                });

            // For inline code
            document.querySelectorAll('code:not([class*="language-"]):not(pre code)')
                .forEach(function(element) {
                    element.classList.add('language-bash');
                    element.classList.add('inline-code');
                });

            originalHighlightAll.apply(this, arguments);
        }
    })(Prism.highlightAll);

    // NOTE(curtis): This is a custom function to highlight inline code as Prism doesn't do it by default
    function highlightInlineCode() {
        document.querySelectorAll('code.inline-code').forEach((block) => {
            Prism.highlightElement(block);
        });
    }

    // Re-run Prism highlighting after the page loads
    document.addEventListener('DOMContentLoaded', (event) => {
        Prism.highlightAll();
        highlightInlineCode();
    });

    // Table of Contents Generator
    document.addEventListener('DOMContentLoaded', function() {
        const article = document.querySelector('article.prose');
        if (!article) return;

        // Get all headers from the article content (h2-h4), excluding those in tables
        const headers = Array.from(article.querySelectorAll('h2, h3, h4')).filter(header => {
            // Exclude headers in tables, TOC itself, and any header containing "Table of Contents"
            return !header.closest('table') && 
                   !header.closest('.toc') && 
                   header.textContent.trim() !== 'Table of Contents' &&
                   !header.textContent.includes('Table of Contents');
        });

        // Only generate TOC if there are more than 3 headers
        if (headers.length <= 3) return;

        // Create and initialize TOC container
        const tocContainer = createTOCContainer();
        tocContainer.id = 'toc-container';
        
        // Generate TOC content
        const { toc, sectionInfo } = generateTOCContent(headers);
        
        // Add TOC to container
        tocContainer.appendChild(toc);
        
        // Insert TOC in the appropriate location
        insertTOC(article, tocContainer);

        // Create floating button container
        const floatingContainer = document.createElement('div');
        floatingContainer.className = 'floating-container prose mx-auto text-center mt-8 mb-4';
        floatingContainer.style.cssText = `
            width: 100%;
            max-width: 65ch;
        `;

        // Create the button
        const backButton = document.createElement('button');
        backButton.textContent = '‚Üë Back to Contents';
        backButton.className = 'bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-gray-700 transition-all duration-200';
        backButton.style.cssText = `
            font-size: 0.875rem;
        `;

        floatingContainer.appendChild(backButton);
        article.appendChild(floatingContainer);

        // Scroll back to TOC when clicked
        backButton.addEventListener('click', () => {
            tocContainer.scrollIntoView({ behavior: 'smooth' });
        });

        // Enable smooth scrolling
        document.documentElement.style.scrollBehavior = 'smooth';
    });

    function createTOCContainer() {
        const container = document.createElement('div');
        container.className = 'toc mb-8 p-4 bg-gray-50 rounded-lg not-prose';
        container.innerHTML = '<h2 class="toc-title text-lg font-semibold mb-2">Table of Contents</h2>';
        return container;
    }

    function generateTOCContent(headers) {
        const toc = document.createElement('ul');
        toc.className = 'space-y-2';
        
        let sectionCount = 1;
        let subsectionCount = 1;
        let lastLevel = 2; // Start with h2 level

        headers.forEach((header, index) => {
            // Ensure header has an ID
            if (!header.id) {
                header.id = `section-${index}`;
            }

            const level = parseInt(header.tagName.charAt(1));
            const { sectionNumber, newSectionCount, newSubsectionCount, newLastLevel } = 
                generateSectionNumber(level, sectionCount, subsectionCount, lastLevel);

            // Update counters
            sectionCount = newSectionCount;
            subsectionCount = newSubsectionCount;
            lastLevel = newLastLevel;

            // Create TOC item
            const item = createTOCItem(header, level, sectionNumber);
            toc.appendChild(item);

            // Update header in content
            header.prepend(document.createTextNode(sectionNumber));
        });

        return { 
            toc,
            sectionInfo: { sectionCount, subsectionCount, lastLevel }
        };
    }

    function generateSectionNumber(level, sectionCount, subsectionCount, lastLevel) {
        let sectionNumber = '';
        let newSectionCount = sectionCount;
        let newSubsectionCount = subsectionCount;
        let newLastLevel = lastLevel;

        if (level === 2) {
            sectionNumber = `${sectionCount}. `;
            newSubsectionCount = 1;
            newSectionCount++;
            newLastLevel = 2;
        } else if (level === 3) {
            sectionNumber = `${sectionCount - 1}.${subsectionCount}. `;
            newSubsectionCount++;
            newLastLevel = 3;
        }

        return {
            sectionNumber,
            newSectionCount,
            newSubsectionCount,
            newLastLevel
        };
    }

    function createTOCItem(header, level, sectionNumber) {
        const item = document.createElement('li');
        const link = document.createElement('a');
        
        link.href = `#${header.id}`;
        link.textContent = sectionNumber + header.textContent;
        link.className = 'text-gray-700 hover:text-gray-900 hover:underline block';

        // Add indentation based on header level
        const indent = level - 2;
        item.style.paddingLeft = `${indent * 1}rem`;
        item.appendChild(link);

        return item;
    }

    function insertTOC(article, tocContainer) {
        const header = article.querySelector('header');
        if (header) {
            header.parentNode.insertBefore(tocContainer, header.nextSibling);
        } else {
            article.insertBefore(tocContainer, article.firstChild);
        }
    }
</script>
<script>
    const backgrounds = [
        '/img/background/background.png',
        '/img/background/background2.png',
        '/img/background/background3.png'
    ];
    const randomBackground = backgrounds[Math.floor(Math.random() * backgrounds.length)];
    document.body.style.backgroundImage = `url('${randomBackground}')`;
    document.body.style.backgroundRepeat = 'repeat';
</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const dropdownToggle = document.querySelector('.dropdown-toggle');
        const dropdownMenu = document.querySelector('.dropdown-menu');

        if (!dropdownToggle || !dropdownMenu) {
            console.error('Dropdown elements not found');
            return;
        }

        dropdownToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });

        // Close the dropdown if the user clicks outside of it
        window.addEventListener('click', function(event) {
            if (!event.target.matches('.dropdown-toggle')) {
                if (dropdownMenu.classList.contains('show')) {
                    dropdownMenu.classList.remove('show');
                }
            }
        });

        // Handle all links in the dropdown menu
        document.querySelectorAll('.dropdown-menu a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                dropdownMenu.classList.remove('show');

                const href = this.getAttribute('href');
                
                // Check if it's an external link or the feed.xml
                if (href.startsWith('http') || href.startsWith('https') || href === '/feed.xml') {
                    window.open(href, '_blank');
                    return;
                }

                // Check if it's the home or archive link
                if (href === '/' || href === '/archive.html') {
                    window.location.href = href;
                    return;
                }

                const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html';
                
                if (isHomePage && href.includes('#')) {
                    // If on home page and it's a section link, smooth scroll
                    const targetId = href.split('#')[1];
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                } else {
                    // If on another page or it's not a section link, navigate to the page
                    window.location.href = href;
                }
            });
        });
    });

    // Function to scroll to section after page load
    function scrollToSection() {
        const hash = window.location.hash;
        if (hash) {
            const targetElement = document.quefrySelector(hash);
            if (targetElement) {
                setTimeout(() => {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }
    }

    // Call scrollToSection after page load
    window.addEventListener('load', scrollToSection);
</script>

</body>
</html>
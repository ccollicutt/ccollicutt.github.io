<!DOCTYPE html>
<html lang="en" class="min-h-screen">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating CUSTOM Secure Software Supply Chains with Tanzu | Server As Code Dot Com</title>
    <meta name="description" content="A blog about technology">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/prism.min.css" rel="stylesheet">
    <link href="/assets/css/extra.css" rel="stylesheet">

    <!-- Twitter cards -->
    <meta name="twitter:site" content="serverascode.com">
    <meta name="twitter:creator" content="Curtis Collicutt">
    <meta name="twitter:title" content="Creating CUSTOM Secure Software Supply Chains with Tanzu">

    
    <meta name="twitter:description" content="<p>In the <a href="/2022/05/10/creating-secure-software-supply-chains-with-tanzu.html">last post</a> I looked at creating secure software supply chains with the Tanzu Application Platform (TAP). In that post I used a default supply chain. But what if we wanted to create our own, custom supply chain instead of using the “out of the box” examples provided with the platform?</p>

">
    <!-- LinkedIn -->
    <meta property="og:description" content="<p>In the <a href="/2022/05/10/creating-secure-software-supply-chains-with-tanzu.html">last post</a> I looked at creating secure software supply chains with the Tanzu Application Platform (TAP). In that post I used a default supply chain. But what if we wanted to create our own, custom supply chain instead of using the “out of the box” examples provided with the platform?</p>

" />
    

    

    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://serverascode.com/img/social/posts/creating-custom-secure-software-supply-chains.png">
    <!-- LinkedIn -->
    <meta property="og:image" content="https://serverascode.com/img/social/posts/creating-custom-secure-software-supply-chains.png" />
    
    <!-- end of Twitter cards -->

    <!-- Additional Open Graph tags for better LinkedIn sharing -->
    <meta property="og:title" content="Creating CUSTOM Secure Software Supply Chains with Tanzu" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://serverascode.com/2022/05/11/creating-custom-secure-software-supply-chains.html" />
    <meta property="og:site_name" content="Server As Code Dot Com" />

</head>
<body class="font-sans">
    <div class="magazine-container">
        <header>
            <div class="magazine-header">
                <div class="issue-number-dropdown">
                    <button class="issue-number-top dropdown-toggle">
                        ISSUE 248
                        <span class="arrow-down"></span>
                    </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-section">
                            <h3>Navigation</h3>
                            <a href="/">Home</a>
                            <a href="/archive.html">Archive</a>
                        </div>
                        <div class="dropdown-section">
                            <h3>Sections</h3>
                            <a href="/#latest-issues">Latest Issues</a>
                            <a href="/#tidal-series">Tidal Series</a>
                            <a href="/#connect-with-me">Connect With Me</a>
                            <a href="/#recent-posts">Recent Posts</a>
                        </div>
                        <div class="dropdown-section">
                            <h3>Connect</h3>
                            
                                
                            
                                
                                    <a href="https://tidalseries.com" target="_blank" rel="noopener noreferrer">TIDAL SERIES Newsletter</a>
                                
                            
                                
                                    <a href="https://www.linkedin.com/in/ccollicutt/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
                                
                            
                                
                                    <a href="https://taico.ca" target="_blank" rel="noopener noreferrer">TAICO - The Toronto AI and Cybersecurity Organization</a>
                                
                            
                                
                                    <a href="https://github.com/ccollicutt" target="_blank" rel="noopener noreferrer">GitHub</a>
                                
                            
                                
                                    <a href="https://huggingface.co/ccollicutt" target="_blank" rel="noopener noreferrer">Hugging Face</a>
                                
                            
                                
                            
                        </div>
                    </div>
                </div>
                <div class="magazine-info">
                    <div>Server As Code Dot Com</div>
                    <div class="underline"><a href="/archive.html">ARCHIVE</a></div>
                    <div class="underline">2024 JUNE</div>
                    <div class="underline">¥980</div>
                </div>
            </div>
            <p class="magazine-subtitle">A techno-blog for our techno-times</p>
            <a href="/" class="logo-link">
                <img src="/img/logo/logo.png" alt="Server As Code Dot Com" class="logo-image">
            </a>
        </header>

        <div class="content-wrapper">
            <main class="flex-grow px-4 md:px-8 main-content">
                <div class="max-w-4xl mx-auto px-4 mt-8 mb-12">
    <div class="flex justify-center space-x-4">
        
        
        <a href="https://serverascode.com" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/author/curtis.jpg" alt="Curtis Collicutt" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">Curtis Collicutt</span>
        </a>
        
        
        
        <a href="https://tidalseries.com" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/tidalseries.png" alt="TIDAL SERIES Newsletter" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">TIDAL SERIES Newsletter</span>
        </a>
        
        
        
        <a href="https://www.linkedin.com/in/ccollicutt/" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/linkedin.png" alt="LinkedIn" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">LinkedIn</span>
        </a>
        
        
        
        
        
        <a href="https://github.com/ccollicutt" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/github.jpg" alt="GitHub" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">GitHub</span>
        </a>
        
        
        
        
        
        
    </div>
</div>

<article class="prose lg:prose-xl mx-auto">
    <header class="mb-8 text-center not-prose">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-2">Creating CUSTOM Secure Software Supply Chains with Tanzu</h1>
        <p class="text-gray-600">
            <time datetime="2022-05-11T00:00:00-04:00">
                May 11, 2022
            </time>
            
        </p>
    </header>

    

    <p>In the <a href="/2022/05/10/creating-secure-software-supply-chains-with-tanzu.html">last post</a> I looked at creating secure software supply chains with the Tanzu Application Platform (TAP). In that post I used a default supply chain. But what if we wanted to create our own, custom supply chain instead of using the “out of the box” examples provided with the platform?</p>

<h2 id="quicklywhat-is-the-tanzu-application-platform">Quickly…What is the Tanzu Application Platform?</h2>

<p>TAP is:</p>

<blockquote>
  <p>VMware Tanzu Application Platform is a modular, application-aware platform that provides a rich set of developer tooling and a prepaved path to production to build and deploy software quickly and securely on any compliant public cloud or on-premises Kubernetes cluster. - <a href="https://tanzu.vmware.com/application-platform">VMware Tanzu</a></p>
</blockquote>

<p>Here’s a key point:</p>

<ul>
  <li>It can run in <strong>any compliant</strong> Kubernetes cluster</li>
</ul>

<p>But enough about TAP, let’s build a custom supply chain.</p>

<h2 id="creating-a-custom-supply-chain">Creating a Custom Supply Chain</h2>

<p>Ok, so we have two supply chains by default in the TAP install.</p>

<pre><code>$ k get clustersupplychains.carto.run
NAME                 READY   REASON   AGE
basic-image-to-url   True    Ready    5d2h
source-to-url        True    Ready    5d2h
</code></pre>

<p>We can also use the tanzu CLI to get the same information.</p>

<pre><code>PS C:\Program Files\tanzu&gt; tanzu apps cluster-supply-chain list
NAME                         READY   AGE   LABEL SELECTOR
scanning-image-scan-to-url   Ready   23m   apps.tanzu.vmware.com/workload-type=web
source-test-scan-to-url      Ready   23m   apps.tanzu.vmware.com/has-tests=true,apps.tanzu.vmware.com/workload-type=web
</code></pre>

<p>The reason we have these two is that when TAP was installed the TAP values file was configured with the below option.</p>

<pre><code>supply_chain: basic
</code></pre>

<p>There are other options to provide “out of the box templates”. That said, we expect that most organizations will build their own supply chains using our platform and its various building blocks.</p>

<p>For the purposes of this blog post I start with the two basic chains and I’d like to add another <em>custom</em> chain, an extension of source-to-url.</p>

<h2 id="creating-a-custom-supply-chain-1">Creating a Custom Supply Chain</h2>

<p>Let’s say my goal is:</p>

<ul>
  <li>Take the “source-to-url” chain, create a new chain, and add “image scanning” to it, so that the image that is created is also scanned to see if there are any CVEs</li>
</ul>

<p>I’m going to grab the “source-to-url” chain and edit it.</p>

<pre><code>$ k neat get  -- clustersupplychains.carto.run source-to-url
apiVersion: carto.run/v1alpha1
kind: ClusterSupplyChain
metadata:
  annotations:
    kapp.k14s.io/identity: v1;/carto.run/ClusterSupplyChain/source-to-url;carto.run/v1alpha1
  name: source-to-url
spec:
  params:
  - default: main
    name: gitops_branch
  - default: supplychain
    name: gitops_user_name
  - default: supplychain
    name: gitops_user_email
  - default: supplychain@cluster.local
    name: gitops_commit_message
  - default: ""
    name: gitops_ssh_secret
  resources:
  - name: source-provider
    params:
    - name: serviceAccount
      value: default
    - name: gitImplementation
      value: go-git
    templateRef:
      kind: ClusterSourceTemplate
      name: source-template
  - name: deliverable
    params:
    - name: registry
      value:
        repository: tap-inner-loop-1-1-full/supply-chain
        server: somerepo.example.com
    templateRef:
      kind: ClusterTemplate
      name: deliverable-template
  - name: image-builder
    params:
    - name: serviceAccount
      value: default
    - name: clusterBuilder
      value: default
    - name: registry
      value:
        repository: tap-inner-loop-1-1-full/supply-chain
        server: somerepo.example.com
    sources:
    - name: source
      resource: source-provider
    templateRef:
      kind: ClusterImageTemplate
      name: kpack-template
  - images:
    - name: image
      resource: image-builder
    name: config-provider
    params:
    - name: serviceAccount
      value: default
    templateRef:
      kind: ClusterConfigTemplate
      name: convention-template
  - configs:
    - name: config
      resource: config-provider
    name: app-config
    templateRef:
      kind: ClusterConfigTemplate
      name: config-template
  - configs:
    - name: config
      resource: app-config
    name: config-writer
    params:
    - name: serviceAccount
      value: default
    - name: registry
      value:
        repository: tap-inner-loop-1-1-full/supply-chain
        server: somerepo.example.com
    templateRef:
      kind: ClusterTemplate
      name: config-writer-template
  selector:
    apps.tanzu.vmware.com/workload-type: web
</code></pre>

<p>Next, let’s change it so that it looks like the below.</p>

<pre><code>apiVersion: carto.run/v1alpha1
kind: ClusterSupplyChain
metadata:
  name: source-to-url-with-image-scan
spec:
  params:
  - default: main
    name: gitops_branch
  - default: supplychain
    name: gitops_user_name
  - default: supplychain
    name: gitops_user_email
  - default: supplychain@cluster.local
    name: gitops_commit_message
  - default: ""
    name: gitops_ssh_secret
  resources:
  - name: source-provider
    params:
    - name: serviceAccount
      value: default
    - name: gitImplementation
      value: go-git
    templateRef:
      kind: ClusterSourceTemplate
      name: source-template
  - name: deliverable
    params:
    - name: registry
      value:
        repository: tap-inner-loop-1-1-full/supply-chain
        server: somerepo.example.com
    templateRef:
      kind: ClusterTemplate
      name: deliverable-template
  - name: image-builder
    params:
    - name: serviceAccount
      value: default
    - name: clusterBuilder
      value: default
    - name: registry
      value:
        repository: tap-inner-loop-1-1-full/supply-chain
        server: somerepo.example.com
    sources:
    - name: source
      resource: source-provider
    templateRef:
      kind: ClusterImageTemplate
      name: kpack-template
  #scan-image
  - name: scan-image
    images:
    - name: image
      resource: image-builder
    templateRef:
      kind: ClusterImageTemplate
      name: image-scanner-template      
  - images:
    - name: image
      resource: scan-image
    name: config-provider
    params:
    - name: serviceAccount
      value: default
    templateRef:
      kind: ClusterConfigTemplate
      name: convention-template
  - configs:
    - name: config
      resource: config-provider
    name: app-config
    templateRef:
      kind: ClusterConfigTemplate
      name: config-template
  - configs:
    - name: config
      resource: app-config
    name: config-writer
    params:
    - name: serviceAccount
      value: default
    - name: registry
      value:
        repository: tap-inner-loop-1-1-full/supply-chain
        server: somerepo.example.com
    templateRef:
      kind: ClusterTemplate
      name: config-writer-template
  selector:
    apps.tanzu.vmware.com/workload-type: web-image-scan
</code></pre>

<blockquote>
  <p>NOTE: The selector is now “web-image-scan”.</p>
</blockquote>

<p>At this point we have a diff something like this. All that’s happened is the insertion of the “scan-image” block into the chain, and changed the name to make it unique.</p>

<pre><code class="language-bash">$ git diff source-to-url-original.yml curtis-source-to-url-with-image-scan.yml
diff --git a/source-to-url-original.yml b/curtis-source-to-url-with-image-scan.yml
index 06e8dff..3c22bac 100644
--- a/source-to-url-original.yml
+++ b/curtis-source-to-url-with-image-scan.yml
@@ -1,12 +1,7 @@
 apiVersion: carto.run/v1alpha1
 kind: ClusterSupplyChain
 metadata:
-  annotations:
-    kapp.k14s.io/identity: v1;/carto.run/ClusterSupplyChain/source-to-url;carto.run/v1alpha1
-  labels:
-    kapp.k14s.io/app: "1651760734110088811"
-    kapp.k14s.io/association: v1.4e1a1027543b1d663294132ebfdd4f33
-  name: source-to-url
+  name: source-to-url-with-image-scan
 spec:
   params:
   - default: main
@@ -54,9 +49,17 @@ spec:
     templateRef:
       kind: ClusterImageTemplate
       name: kpack-template
-  - images:
+  #scan-image
+  - name: scan-image
+    images:
     - name: image
       resource: image-builder
+    templateRef:
+      kind: ClusterImageTemplate
+      name: image-scanner-template      
+  - images:
+    - name: image
+      resource: scan-image
     name: config-provider
     params:
     - name: serviceAccount
@@ -86,4 +89,4 @@ spec:
       kind: ClusterTemplate
       name: config-writer-template
   selector:
-    apps.tanzu.vmware.com/workload-type: web
\ No newline at end of file
+    apps.tanzu.vmware.com/workload-type: web-image-scan
\ No newline at end of file
</code></pre>

<p>The new chain looks like this in Cartographer’s live editor. As you can see, there is now “scan-image” in the chain.</p>

<p><img src="/img/carto3.jpg" alt="image scan pipeline" /></p>

<p>Which, of course, is different from the non-image scan version. Note how there is no “scan image” box.</p>

<p><img src="/img/carto2.jpg" alt="cartographer diagram 2" /></p>

<p>Checkout the image scanner template.</p>

<pre><code>$ k neat get -- clusterimagetemplates.carto.run image-scanner-template -oyaml
apiVersion: carto.run/v1alpha1
kind: ClusterImageTemplate
metadata:
  annotations:
    kapp.k14s.io/identity: v1;/carto.run/ClusterImageTemplate/image-scanner-template;carto.run/v1alpha1
    kapp.k14s.io/original-diff-md5: c6e94dc94aed3401b5d0f26ed6c0bff3
  labels:
    kapp.k14s.io/app: "1651760721125747499"
    kapp.k14s.io/association: v1.7d6419553fe4d29522bcc6dc11d61feb
  name: image-scanner-template
spec:
  imagePath: .status.compliantArtifact.registry.image
  ytt: |
    #@ load("@ytt:data", "data")

    #@ def merge_labels(fixed_values):
    #@   labels = {}
    #@   if hasattr(data.values.workload.metadata, "labels"):
    #@     labels.update(data.values.workload.metadata.labels)
    #@   end
    #@   labels.update(fixed_values)
    #@   return labels
    #@ end

    apiVersion: scanning.apps.tanzu.vmware.com/v1beta1
    kind: ImageScan
    metadata:
      name: #@ data.values.workload.metadata.name
      labels: #@ merge_labels({ "app.kubernetes.io/component": "image-scan" })
    spec:
      registry:
        image: #@ data.values.image
      scanTemplate: private-image-scan-template
      scanPolicy: scan-policy
</code></pre>

<p>If we look at the above definition, we see that it’s using “private-image-scan-template” of “kind: ImageScan”.</p>

<p>Let’s look at those.</p>

<pre><code>$ k get scantemplates.scanning.apps.tanzu.vmware.com
NAME                          AGE
blob-source-scan-template     5d2h
private-image-scan-template   5d2h
public-image-scan-template    5d2h
public-source-scan-template   5d2h
</code></pre>

<p>Now the private scan template…</p>

<pre><code>$ k neat get -- scantemplates.scanning.apps.tanzu.vmware.com private-image-scan-template -oyaml
apiVersion: scanning.apps.tanzu.vmware.com/v1beta1
kind: ScanTemplate
metadata:
  name: private-image-scan-template
  namespace: default
spec:
  template:
    containers:
    - args:
      - -c
      - ./image/copy-docker-config.sh /secret-data &amp;&amp; ./image/scan-image.sh /workspace
        scan.xml true
      command:
      - /bin/bash
      image: registry.tanzu.vmware.com/tanzu-application-platform/tap-packages@sha256:d3a8f3cae0db15e416e805dc598223f93059c3a295cbf33f1409bc6cb9a9709c
      imagePullPolicy: IfNotPresent
      name: scanner
      resources:
        limits:
          cpu: 1000m
        requests:
          cpu: 250m
          memory: 128Mi
      volumeMounts:
      - mountPath: /.docker
        name: docker
        readOnly: false
      - mountPath: /workspace
        name: workspace
        readOnly: false
      - mountPath: /secret-data
        name: registry-cred
        readOnly: true
    imagePullSecrets:
    - name: scanner-secret-ref
    restartPolicy: Never
    securityContext:
      runAsNonRoot: true
    volumes:
    - name: docker
    - name: workspace
    - name: registry-cred
      secret:
        secretName: registry-credentials
</code></pre>

<p>Ok, great. To do image scanning we’ll need a scan policy.</p>

<h2 id="scan-policy">Scan Policy</h2>

<p>Next we need a scan policy.</p>

<blockquote>
  <p>NOTE: We are only looking for “Critical” vulnerabilities. Those will fail, everything else will pass the scan test.</p>
</blockquote>

<pre><code>apiVersion: scanning.apps.tanzu.vmware.com/v1beta1
kind: ScanPolicy
metadata:
  name: scan-policy
spec:
  regoFile: |
    package policies

    default isCompliant = false

    # Accepted Values: "Critical", "High", "Medium", "Low", "Negligible", "UnknownSeverity"
    violatingSeverities := ["Critical"]
    ignoreCVEs := []

    contains(array, elem) = true {
      array[_] = elem
    } else = false { true }

    isSafe(match) {
      fails := contains(violatingSeverities, match.Ratings.Rating[_].Severity)
      not fails
    }

    isSafe(match) {
      ignore := contains(ignoreCVEs, match.Id)
      ignore
    }

    isCompliant = isSafe(input.currentVulnerability)
</code></pre>

<p>That needs to be installed.</p>

<pre><code>$ k create -f image-scan-policy.yml
</code></pre>

<p>Now it’s available to use.</p>

<h2 id="install-and-use">Install and Use</h2>

<p>Let’s load that new, custom supply chain into TAP/k8s.</p>

<pre><code>$ k create -f curtis-source-to-url-with-image-scan.yml
clustersupplychain.carto.run/source-to-url-with-image-scan created
</code></pre>

<p>Voila:</p>

<pre><code>$ k get clustersupplychains.carto.run
NAME                            READY   REASON   AGE
basic-image-to-url              True    Ready    5d2h
source-to-url                   True    Ready    5d2h
source-to-url-with-image-scan   True    Ready    19s
</code></pre>

<p>Now to deploy the app.</p>

<blockquote>
  <p>NOTE: I’m flipping between an Ubuntu WSL terminal and a Powershell terminal. Here I’m using Powershell to run the tanzu CLI. Note the type is “web-image-scan”.</p>
</blockquote>

<pre><code>$Env:TAP_DEV_NAMESPACE = "default"
tanzu apps workload create tanzu-java-web-app-with-image-scan `
  --git-repo https://github.com/sample-accelerators/tanzu-java-web-app `
  --git-branch main `
  --type web-image-scan `
  --label app.kubernetes.io/part-of=tanzu-java-web-app-with-image-scan `
  --label tanzu.app.live.view=true `
  --label tanzu.app.live.view.application.name=tanzu-java-web-app-with-image-scan `
  --annotation autoscaling.knative.dev/minScale=1 `
  --namespace $env:TAP_DEV_NAMESPACE `
  --yes
</code></pre>

<p>I can check the results of the scan.</p>

<pre><code>$ k logs scan-tanzu-java-web-app-with-image-scan-qr9q4--1-9b4w9 | grep severity | sort | uniq -c
     27               &lt;v:severity&gt;Low&lt;/v:severity&gt;
      8               &lt;v:severity&gt;Medium&lt;/v:severity&gt;
</code></pre>

<p>Many low, a few medium.</p>

<p>Now we have imagescans:</p>

<pre><code>$ k get imagescans.scanning.apps.tanzu.vmware.com
NAME                                 PHASE       SCANNEDIMAGE
                                                                                                            AGE   CRITICAL   HIGH   MEDIUM   LOW   UNKNOWN   CVETOTAL
tanzu-java-web-app-with-image-scan   Completed   somerepo.example.com/tap-inner-loop-1-1-full/supply-chain/tanzu-java-web-app-with-image-scan-default@sha256:bb0da26d42537abaa7a7f02afac8eb77387c42524fbd413a265d716934ec2f4c   20m   0          0      3        12    0         15
</code></pre>

<p>The app is up and running.</p>

<pre><code>PS C:\Users\curtis&gt; curl.exe http://tanzu-java-web-app-with-image-scan-default.apps.example.com
Greetings from Spring Boot + Tanzu!
</code></pre>
<h2 id="conclusion">Conclusion</h2>

<p>At this point we’ve created a custom supply chain by adding image scanning to the default source-to-url chain.</p>

<p>This is a simple example, but you can see how powerful, and modular, TAP is.</p>

<h2 id="additional-links-and-resources">Additional Links and Resources</h2>

<ul>
  <li><a href="https://dodd-pfeffer.medium.com/tanzu-application-platforms-ootb-supply-chain-with-testing-and-scanning-events-cfc0d50506f7">Tanzu Application Platform’s OOTB Supply Chain with Testing and Scanning Events</a></li>
  <li><a href="https://dodd-pfeffer.medium.com/deep-dive-on-tanzu-application-platforms-ootb-supply-chain-ac8a929d2e43">Deep-dive on Tanzu Application Platform’s OOTB Supply Chain</a></li>
  <li><a href="https://tanzu.vmware.com/developer/learningpaths/secure-software-supply-chain/">SSSC learning path</a> provided by VMware Tanzu.</li>
</ul>

</article>
            </main>

            <footer class="mt-12 py-4 text-center text-xs text-gray-500 border-t font-light">
                <p>&copy; 2024 Server As Code Dot Com. All rights reserved.</p>
            </footer>

            <div class="issue-number-large">
                248
            </div>
        </div>
    </div>

<!-- Prism.js for syntax highlighting -->
<script src="/assets/js/prism.min.js"></script>
<script>
    // This script should be placed after the Prism.js script
    if (Prism.plugins && Prism.plugins.NormalizeWhitespace) {
        Prism.plugins.NormalizeWhitespace.setDefaults({
            'remove-trailing': true,
            'remove-indent': true,
            'left-trim': true,
            'right-trim': true
        });
    }

    // NOTE(curtis): None of the ``` in my posts had a language specified, so I'm setting it to bash by default
    Prism.highlightAll = (function (originalHighlightAll) {
        return function () {
            // For block code
            document.querySelectorAll('pre code:not([class*="language-"])')
                .forEach(function(element) {
                    element.classList.add('language-bash');
                });

            // For inline code
            document.querySelectorAll('code:not([class*="language-"]):not(pre code)')
                .forEach(function(element) {
                    element.classList.add('language-bash');
                    element.classList.add('inline-code');
                });

            originalHighlightAll.apply(this, arguments);
        }
    })(Prism.highlightAll);

    // NOTE(curtis): This is a custom function to highlight inline code as Prism doesn't do it by default
    function highlightInlineCode() {
        document.querySelectorAll('code.inline-code').forEach((block) => {
            Prism.highlightElement(block);
        });
    }

    // Re-run Prism highlighting after the page loads
    document.addEventListener('DOMContentLoaded', (event) => {
        Prism.highlightAll();
        highlightInlineCode();
    });
</script>
<script>
    const backgrounds = [
        '/img/background/background.png',
        '/img/background/background2.png',
        '/img/background/background3.png'
    ];
    const randomBackground = backgrounds[Math.floor(Math.random() * backgrounds.length)];
    document.body.style.backgroundImage = `url('${randomBackground}')`;
    document.body.style.backgroundRepeat = 'repeat';
</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const dropdownToggle = document.querySelector('.dropdown-toggle');
        const dropdownMenu = document.querySelector('.dropdown-menu');
    
        if (!dropdownToggle || !dropdownMenu) {
            console.error('Dropdown elements not found');
            return;
        }
    
        dropdownToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });
    
        // Close the dropdown if the user clicks outside of it
        window.addEventListener('click', function(event) {
            if (!event.target.matches('.dropdown-toggle')) {
                if (dropdownMenu.classList.contains('show')) {
                    dropdownMenu.classList.remove('show');
                }
            }
        });
    
        // Handle all links in the dropdown menu
        document.querySelectorAll('.dropdown-menu a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                dropdownMenu.classList.remove('show');
    
                const href = this.getAttribute('href');
                
                // Check if it's an external link
                if (href.startsWith('http') || href.startsWith('https')) {
                    window.open(href, '_blank');
                    return;
                }
    
                // Check if it's the home or archive link
                if (href === '/' || href === '/archive.html') {
                    window.location.href = href;
                    return;
                }
    
                const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html';
                
                if (isHomePage && href.includes('#')) {
                    // If on home page and it's a section link, smooth scroll
                    const targetId = href.split('#')[1];
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                } else {
                    // If on another page or it's not a section link, navigate to the page
                    window.location.href = href;
                }
            });
        });
    });
    
    // Function to scroll to section after page load
    function scrollToSection() {
        const hash = window.location.hash;
        if (hash) {
            const targetElement = document.querySelector(hash);
            if (targetElement) {
                setTimeout(() => {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }
    }
    
    // Call scrollToSection after page load
    window.addEventListener('load', scrollToSection);
</script>

</body>
</html>
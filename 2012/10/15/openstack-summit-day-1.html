<!DOCTYPE html>
<html lang="en" class="min-h-screen">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenStack 2012 Summit Day &#35;1 | Server As Code Dot Com</title>
    <meta name="description" content="A techno-blog for our techno-times">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/prism.min.css" rel="stylesheet">
    <link href="/assets/css/extra.css" rel="stylesheet">

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/img/favicon/site.webmanifest">
    <link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <meta name="twitter:site" content="serverascode.com">
    <meta name="twitter:creator" content="Curtis Collicutt">
    
    
        <meta name="twitter:title" content="OpenStack 2012 Summit Day &#35;1">
        
        <meta name="twitter:description" content="This week I’m at the OpenStack 2012 Summit. It’s by far the biggest conference I’ve been to. Usually I go to conferences on security, such as H.O.P.E or CanS...">
        <meta property="og:description" content="This week I’m at the OpenStack 2012 Summit. It’s by far the biggest conference I’ve been to. Usually I go to conferences on security, such as H.O.P.E or CanS..." />
        
        <meta property="og:title" content="OpenStack 2012 Summit Day &#35;1" />
        <meta property="og:type" content="article" />
    
    
    
    
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://serverascode.com/img/social/posts/openstack-summit-day-1.png">
    <meta property="og:image" content="https://serverascode.com/img/social/posts/openstack-summit-day-1.png" />
    
    
    <meta property="og:url" content="https://serverascode.com/2012/10/15/openstack-summit-day-1.html" />
    <meta property="og:site_name" content="Server As Code Dot Com" />
</head>
<body class="font-sans">
    <div class="magazine-container">
        <header>
            <div class="magazine-header">
                <div class="issue-number-dropdown">
                    <button class="issue-number-top dropdown-toggle">
                        ISSUE 259
                        <span class="arrow-down"></span>
                    </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-section">
                            <h3>Navigation</h3>
                            <a href="/">Home</a>
                            <a href="/archive.html">Archive</a>
                            <a href="/feed.xml">RSS Feed</a>
                        </div>
                        <div class="dropdown-section">
                            <h3>Sections</h3>
                            <a href="/#latest-issues">Latest Issues</a>
                            <a href="/#tidal-series">Tidal Series</a>
                            <a href="/#connect-with-me">Connect With Me</a>
                            <a href="/#recent-posts">Recent Posts</a>
                        </div>
                        <div class="dropdown-section">
                            <h3>Connect</h3>
                            
                                
                            
                                
                                    <a href="https://tidalseries.com" target="_blank" rel="noopener noreferrer">TIDAL SERIES Newsletter</a>
                                
                            
                                
                                    <a href="https://www.linkedin.com/in/ccollicutt/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
                                
                            
                                
                                    <a href="https://taico.ca" target="_blank" rel="noopener noreferrer">TAICO - The Toronto AI and Cybersecurity Organization</a>
                                
                            
                                
                                    <a href="https://github.com/ccollicutt" target="_blank" rel="noopener noreferrer">GitHub</a>
                                
                            
                                
                                    <a href="https://huggingface.co/ccollicutt" target="_blank" rel="noopener noreferrer">Hugging Face</a>
                                
                            
                                
                            
                        </div>
                    </div>
                </div>
                <div class="magazine-info">
                    <div>Server As Code Dot Com</div>
                    <div class="underline"><a href="/archive.html">ARCHIVE</a></div>
                    <div class="underline">2025 FEBRUARY</div>
                    <div class="underline">¥980</div>
                </div>
            </div>
            <p class="magazine-subtitle">A techno-blog for our techno-times</p>
            <a href="/" class="logo-link">
                <img src="/img/logo/logo.png" alt="Server As Code Dot Com" class="logo-image">
            </a>
        </header>

        <div class="content-wrapper">
            <main class="flex-grow px-4 md:px-8 main-content">
                <div class="max-w-4xl mx-auto px-4 mt-8 mb-12">
    <div class="flex justify-center space-x-4">
        
        
        <a href="https://serverascode.com" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/author/curtis.jpg" alt="Curtis Collicutt" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">Curtis Collicutt</span>
        </a>
        
        
        
        <a href="https://tidalseries.com" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/tidalseries.png" alt="TIDAL SERIES Newsletter" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">TIDAL SERIES Newsletter</span>
        </a>
        
        
        
        <a href="https://www.linkedin.com/in/ccollicutt/" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/linkedin.png" alt="LinkedIn" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">LinkedIn</span>
        </a>
        
        
        
        
        
        <a href="https://github.com/ccollicutt" class="group flex flex-col items-center bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3" target="_blank" rel="noopener noreferrer">
            <img src="/img/cards/github.jpg" alt="GitHub" class="w-14 h-14 object-cover rounded-full mb-2">
            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900 text-center">GitHub</span>
        </a>
        
        
        
        
        
        
    </div>
</div>

<article class="prose lg:prose-xl mx-auto">
    <header class="mb-8 text-center not-prose">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-2">OpenStack 2012 Summit Day &#35;1</h1>
        <p class="text-gray-600">
            <time datetime="2012-10-15T00:00:00-04:00">
                October 15, 2012
            </time>
            
        </p>
    </header>

    <div id="toc" class="hidden mb-8 p-4 bg-gray-50 rounded-lg not-prose">
        <h2 class="text-lg font-semibold mb-2">Table of Contents</h2>
        <nav id="toc-content"></nav>
    </div>

    

    <p>This week I’m at the OpenStack 2012 Summit. It’s by far the biggest conference I’ve been to. Usually I go to conferences on security, such as <a href="http://en.wikipedia.org/wiki/Hackers_on_Planet_Earth">H.O.P.E</a> or <a href="http://cansecwest.com/">CanSec</a> or even smaller library related conferences. Given that OpenStack is one of the fastest growing open source projects of all time, it’s no surprise to find out that the conference has grown from 75 people a couple years ago, to about 1300 this year, up from 700 only a year ago. It’s massive and it’s growing.</p>

<h2 id="tldr">tl;dr</h2>

<ul>
  <li>Need to get into Ceph</li>
  <li>Database as a service too</li>
  <li>Upgrading is a big issue in OpenStack</li>
  <li>San Diego is nice</li>
  <li>OpenStack is kinda a big deal</li>
</ul>

<h2 id="opening-keynote">Opening “keynote”</h2>

<p>Not much to say here, some summit housekeeping with trippy techno rave music to wake me up. :)</p>

<h2 id="open-compute">Open Compute</h2>

<p>The first session I attended was by <a href="https://twitter.com/coleinthecloud">Cole Crawford</a> of the <a href="http://opencompute.org/">Open Compute Foundation</a>. Basically this was an overview of the history of things like the 19” rack (it came from waaaaay back from the train system) and how we need to change our standards to allow things like interoperability and other good stuff.</p>

<p>I was hoping to find out how a small organization–like the one that I work for–could be involved in Open Compute, specifically how we could access similar hardware as Facebook and others are using. I didn’t quite get that out of the presentation, but hopefully in the future I will be able to get us into Open Compute hardware in some fashion or another.</p>

<p>At the very least I signed up for the mailing list. :)</p>

<h2 id="intercloud-object-storage-colony">Intercloud Object Storage: Colony</h2>

<p>The <a href="https://github.com/nii-cloud/colony">Colony</a> session was lead by Shigetoshi Yokoyama of the <a href="http://www.nii.ac.jp/en/">Japan National Institute of Informatics</a> and there is a copy of the slides  <a href="http://www.slideshare.net/shigetoshi-yokoyama/openstack-design-summit-colony-session-12603753">online</a>. Colony is described as “federated swifts” for intercloud object storage services.</p>

<p>Having worked in a world class library that was interested in running petabytes of storage, I’m enthralled with object storage. It’s an important storage paradigm, and surprisingly, for reasons unknown, one that doesn’t seem to get a lot of attention in Canada. Perhaps it’s because startups and other organizations just use S3 and haven’t run into any privacy issues as of yet. Speaking of Amazon S3: it has a trillion+ objects stored now.</p>

<p>I think that in situations where we need to store a lot of replicated data–such as what a library or researcher would like to, or rather <em>should</em> like to store–object storage such as swift is a great way to go. (Though that said, perhaps systems like <a href="http://aws.amazon.com/glacier/">Amazon’s Glacier</a> make more sense for those use cases, but maybe not.) I was at a presentation by the then <a href="http://webdocs.cs.ualberta.ca/~jonathan/">CIO of the University of Alberta</a> who figured there was three to five petabytes of research data on campus that needs to be preserved. That’s a lot of storage, especially when factoring in replication, and it really needs to happen at some point–and it can’t just be a huge tape system.</p>

<p>Further, considering that libraries and researchers  (ie. their respective Universities and organizations), are supposed to work together it would make sense to be able to have some kind of interoperability between object storage clouds, private or otherwise, even if it’s just for some geographic separation.</p>

<p>Certainly Colonly is going to be a project to keep an eye on as object storage evolves and we try to do it across data centers and organizations.</p>

<h2 id="operating-your-openstack-private-cloud">Operating your OpenStack Private Cloud</h2>

<p>The next session I attended was <a href="http://www.openstack.org/summit/san-diego-2012/openstack-summit-sessions/">Operating your OpenStack Private Cloud</a>, which is good because that is one of the things that I do. I manage a small, eight node, OpenStack cluster that will eventually backend a <a href="https://cwiki.apache.org/VCL/apache-vcl.html">Apache VCL</a> setup for virtual classrooms. So a very small private cloud, but I’ve still hit a few “pain points” that larger installations do.</p>

<p>A few points the speaker made:</p>

<ul>
  <li>Monitoring: statsd, graphite, etc</li>
  <li>Operations tools don’t exist for OpenStack (yet)–we need better ops tools so he wrote <a href="https://github.com/JCallicoat/pulsar">Pulsar</a></li>
  <li>Would be nice to see an operations dashboard (perhaps in horizon)</li>
  <li>Eg. can’t get a list of all instances on a node and their IP addresses</li>
  <li>Some tools need hostnames and some need ids…why</li>
  <li>DSH for Ubuntu, PSH for Redhat?</li>
  <li>Don’t forget your bashfu; still working with Linux :)</li>
  <li>Database backups</li>
  <li><a href="http://hollandbackup.org/">Holland</a></li>
  <li>Performance and scale considerations</li>
  <li>Block storage solution of some kind (cinder, or cinder + some vendor)</li>
  <li>Local disk - raw image is only slightly faster than qcow2, but qcow2 may make better business sense</li>
  <li>IO will degrade on local disks when glance copies images between machines</li>
  <li>Scheduling</li>
  <li>CFQ made the most sense</li>
  <li>You have the power to change all this! You have the power to change your scheduler! Benchmark workloads and plan accordingly.</li>
  <li>Lots of things you can do with glance performance-wise</li>
  <li>Image caching</li>
  <li>If you’re using qcow2 it doesn’t have to move the whole image (something to check into)</li>
  <li>Don’t want swift to become unbalanced</li>
  <li>They use chef for automated deployment</li>
  <li>controller in 15 minutes</li>
  <li>compute in two</li>
  <li>Day to day tasks</li>
  <li>Made up of mostly dealing with new issues</li>
  <li>Eg. resizing</li>
  <li>Hardware failures…still have all this hardware</li>
  <li>Don’t forget–it’s not (always) you, it’s a bug</li>
  <li>Nice thing about a private cloud is you can pick the architecture that matches your requirements</li>
  <li>OpenStack/We need to provide an upgrade path (I hear this 20 times today)</li>
  <li>Metrics</li>
  <li>Load average is actually quite telling</li>
  <li>How long does an API call take?</li>
</ul>

<h2 id="lunch">Lunch!</h2>

<p>Lunch was Ok. There are so many people here it’s tough to move around. And given OpenStack gave out giant bags, everyone (like me) has their own personal giant bag, plus the one they got from OpenStack (though I gave mine back). Giant bags galore!</p>

<p>Then I had a beer at the bar downstairs:</p>

<p><img src="https://raw.github.com/ccollicutt/ccollicutt.github.com/master/img/openstack_summit_2012_bar.jpg" alt="" /></p>

<h2 id="database-as-a-service">Database as a Service</h2>

<p>This session is specifically about <a href="http://wiki.openstack.org/DatabaseAsAService">RedDwarf</a>. RedDwarf is taking MySQL and treating it like a “first class citizen” in OpenStack. It’s a managed MySQL database service.</p>

<p>I believe that SQL databases should be separated out from compute. That said, there are many people that would disagree with me. There’s a theory out there that storage and compute should be together on the same nodes, and if that’s the case then I assume so would database. Right now I would prefer to separate out storage, compute, and database. Maybe it doesn’t fit perfectly with the cloud paradigm, but sometimes you have to apply technology not just theorize about it. SQL isn’t going anywhere, and neither is its unique workload.</p>

<p>HP and Rackspace have slightly different implementations of RedDwarf, and both of their services are in production. Each are trying to keep their system compatible with OpenStack, and have committed themselves to using the same CLI: <a href="https://github.com/hub-cap/python-reddwarfclient">python-reddwarfclient</a>. Further, they are both using OpenStack-common and Swift for securely storing database snapshots.</p>

<p>The team has a desire to bring RedDwarf forward, and they want to involve more community usage and get it into incubation in OpenStack and at that point a lot of doors open, such as a GUI in Horizon.</p>

<p>You can get a test install using the below commands, and it will “fake” a nova backend.</p>

<pre>
<code>$ git clone https://github.com/hub-cap/reddwarf_lite
$ ./reddwarf_lite/bin/start_server.sh
</code>
</pre>

<p>There was also a lot of discussion as to the fact that RedDwarf could be used to build <em>Other Things as a Service</em> and also the fact that they are running it on top of OpenVZ versus another virtualization hypervisor and did so for performance reasons (up to 30% better was a number mentioned).</p>

<h2 id="extending-openstack-for-fun-and-profit-creating-new-functionality-with-the-enhancements-api">Extending OpenStack for Fun and Profit: Creating New Functionality with the Enhancements API</h2>

<p>This session is about having two sides–one side is OpenStack, and the other side is “your innovation”. It’s about getting OpenStack and your innovation to talk to one another; about getting your innovation to market and make money.</p>

<p>The speaker, Tim Smith, is the <a href="http://www.gridcentric.com/company/management/">co-founder</a> of GridCentric which has essentially implemented <em>fork()</em> for virtual machines. The main idea is spin up replica instances quickly and efficiently. They are reinventing boot, and in order to do that they need to extend Nova. GridCentric’s code for their extension is up on <a href="https://github.com/gridcentric/openstack">github</a> and would be a good example to work from. (I’ve looked at GridCentric’s offerings before in relation to virtual classrooms–ie. not having a bootstorm when a bunch of students startup instances for a class. With something like GridCentric’s technology you don’t have to boot the instance.)</p>

<p>Nova is a framework providing:</p>
<ul>
  <li>A standardized API</li>
  <li>Messaging/RPC</li>
  <li>Database-backed ORM</li>
</ul>

<p>Nova can be extended by:</p>
<ul>
  <li>API extensions</li>
  <li>Custom “services”</li>
  <li>Nova CLI extensions</li>
  <li>Dashboard extensions</li>
</ul>

<p>Tim suggests that there are a few business challenges such as the fast evolution of OpenStack but generally seems positive about extending OpenStack. Certainly GridCentric has based some of their business on OpenStack.</p>

<p>A commenter noted that there are actually pre-action and post-action boot hooks in Folsom which may help to extend Nova.</p>

<h2 id="storing-vms-with-cinder-and-ceph-rbd">Storing VMs with Cinder and Ceph RBD</h2>

<p>Considering how interested I am in storage, this project, <a href="http://ceph.com/">Ceph</a>, is one of the most important I know of. So when Josh from Inktank talks about Ceph, I’m here to listen. As a note, this room is standing room only for this session!</p>

<p>Ceph is designed for scalability–it has no single point of failure, and you don’t have to be locked into a single hardware vendor. It’s software based and self-managing. There is also the ability to run custom functions on the storage node–such as create a thumbnail from an image file.</p>

<p><a href="http://ceph.com/wiki/Custom_data_placement_with_CRUSH">CRUSH</a> is basically what sets Ceph apart from other storage systems. It’s a pseudo-random placement algorithm and it ensures even distribution across the cluster and has a rules-based system. Basically it avoids look up tables, which eventually kill distributed storage. Further, unlike RAID the entire cluster can recover in parallel.</p>

<p>RBD, the Rados Block Device, is the part of Ceph used to access block storage. KVM has a native driver for RBD. They are thin-provisioned, striped across nodes, and support snapshots and cloning. With RBD you can spin up thousands of virtual machines with the same base image.</p>

<p>Why use block storage in OpenStack?</p>
<ul>
  <li>Persistent</li>
  <li>Not tied to a single host–decouple storage from compute</li>
  <li>Enables live migration</li>
</ul>

<p>Now with Folsom, Cinder has learned how to talk to Glance, which can respond with Images–ie. boot from volume. But still involves a large copy from Glance. However, images can be stored in RBD, and have been able to for some time! So we can skip the copy and just use RBD directly.</p>

<p>That said, it isn’t quite perfect yet. There are enhancements being made in Grizzly. Eg. is not in Horizon, but is in the API and CLI.</p>

<p>NOTES:</p>
<ul>
  <li>The Ceph file system is not recommended for production, but everything else is, such as RBD. If you don’t use the Ceph file system you don’t need metadata servers.</li>
  <li>According to Josh, in terms of running OSDs on the same node as the hypervisor, as long as you have enough memory you should be Ok. Everything is running in userspace. This runs a bit counterintuitive to me, and also is contrary to one of the positive points made about block storage–decoupling. But it’s a valid use case.</li>
</ul>

<h2 id="from-folsom-to-grizzy-a-devops-upgrade-pattern">From Folsom to Grizzy: A DevOps Upgrade Pattern</h2>

<p>This was the last session of the day, and I was quite tired, so apologies. Suffice it to say: <em>Even imagining upgrading OpenStack is difficult and requires a lot of bullet points</em>.</p>

<h2 id="misc-notes-from-the-day">Misc Notes from the Day</h2>
<p></p>
<ul>
  <li>There’s free sunshine and <em>stout</em> outside on the balcony</li>
  <li><a href="http://www.buildcloudstorage.com/2012/08/is-openstack-swift-reliable-enough-for.html">Probability of data loss in Swift</a> (this is not to say it’s high, rather an analysis)</li>
  <li>Infiniband doesn’t have a lot of traction in OpenStack AFAIK, need to look into this</li>
  <li>San Diego has basically the same weather all the time</li>
  <li>Japan’s summers are very hot and humid</li>
  <li>!https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-ash4/430171_10150245244739982_1571995757_n.jpg!</li>
</ul>


</article>
            </main>

            <footer class="mt-12 py-4 text-center text-xs text-gray-500 border-t font-light">
                <p>&copy; 2025 Server As Code Dot Com. All rights reserved.</p>
            </footer>

            <div class="issue-number-large">
                259
            </div>
        </div>
    </div>

<!-- Prism.js for syntax highlighting -->
<script src="/assets/js/prism.min.js"></script>
<script>
    // This script should be placed after the Prism.js script
    if (Prism.plugins && Prism.plugins.NormalizeWhitespace) {
        Prism.plugins.NormalizeWhitespace.setDefaults({
            'remove-trailing': true,
            'remove-indent': true,
            'left-trim': true,
            'right-trim': true
        });
    }

    // NOTE(curtis): None of the ``` in my posts had a language specified, so I'm setting it to bash by default
    Prism.highlightAll = (function (originalHighlightAll) {
        return function () {
            // For block code
            document.querySelectorAll('pre code:not([class*="language-"])')
                .forEach(function(element) {
                    element.classList.add('language-bash');
                });

            // For inline code
            document.querySelectorAll('code:not([class*="language-"]):not(pre code)')
                .forEach(function(element) {
                    element.classList.add('language-bash');
                    element.classList.add('inline-code');
                });

            originalHighlightAll.apply(this, arguments);
        }
    })(Prism.highlightAll);

    // NOTE(curtis): This is a custom function to highlight inline code as Prism doesn't do it by default
    function highlightInlineCode() {
        document.querySelectorAll('code.inline-code').forEach((block) => {
            Prism.highlightElement(block);
        });
    }

    // Re-run Prism highlighting after the page loads
    document.addEventListener('DOMContentLoaded', (event) => {
        Prism.highlightAll();
        highlightInlineCode();
    });

    // Table of Contents Generator
    document.addEventListener('DOMContentLoaded', function() {
        const article = document.querySelector('article.prose');
        if (!article) return;

        // Get all headers from the article content (h2-h4), excluding those in tables
        const headers = Array.from(article.querySelectorAll('h2, h3, h4')).filter(header => {
            // Exclude headers in tables, TOC itself, and any header containing "Table of Contents"
            return !header.closest('table') && 
                   !header.closest('.toc') && 
                   header.textContent.trim() !== 'Table of Contents' &&
                   !header.textContent.includes('Table of Contents');
        });

        // Only generate TOC if there are more than 3 headers
        if (headers.length <= 3) return;

        // Create and initialize TOC container
        const tocContainer = createTOCContainer();
        tocContainer.id = 'toc-container';
        
        // Generate TOC content
        const { toc, sectionInfo } = generateTOCContent(headers);
        
        // Add TOC to container
        tocContainer.appendChild(toc);
        
        // Insert TOC in the appropriate location
        insertTOC(article, tocContainer);

        // Create floating button container
        const floatingContainer = document.createElement('div');
        floatingContainer.className = 'floating-container prose mx-auto text-center mt-8 mb-4';
        floatingContainer.style.cssText = `
            width: 100%;
            max-width: 65ch;
        `;

        // Create the button
        const backButton = document.createElement('button');
        backButton.textContent = '↑ Back to Contents';
        backButton.className = 'bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-gray-700 transition-all duration-200';
        backButton.style.cssText = `
            font-size: 0.875rem;
        `;

        floatingContainer.appendChild(backButton);
        article.appendChild(floatingContainer);

        // Scroll back to TOC when clicked
        backButton.addEventListener('click', () => {
            tocContainer.scrollIntoView({ behavior: 'smooth' });
        });

        // Enable smooth scrolling
        document.documentElement.style.scrollBehavior = 'smooth';
    });

    function createTOCContainer() {
        const container = document.createElement('div');
        container.className = 'toc mb-8 p-4 bg-gray-50 rounded-lg not-prose';
        container.innerHTML = '<h2 class="toc-title text-lg font-semibold mb-2">Table of Contents</h2>';
        return container;
    }

    function generateTOCContent(headers) {
        const toc = document.createElement('ul');
        toc.className = 'space-y-2';
        
        let sectionCount = 1;
        let subsectionCount = 1;
        let lastLevel = 2; // Start with h2 level

        headers.forEach((header, index) => {
            // Ensure header has an ID
            if (!header.id) {
                header.id = `section-${index}`;
            }

            const level = parseInt(header.tagName.charAt(1));
            const { sectionNumber, newSectionCount, newSubsectionCount, newLastLevel } = 
                generateSectionNumber(level, sectionCount, subsectionCount, lastLevel);

            // Update counters
            sectionCount = newSectionCount;
            subsectionCount = newSubsectionCount;
            lastLevel = newLastLevel;

            // Create TOC item
            const item = createTOCItem(header, level, sectionNumber);
            toc.appendChild(item);

            // Update header in content
            header.prepend(document.createTextNode(sectionNumber));
        });

        return { 
            toc,
            sectionInfo: { sectionCount, subsectionCount, lastLevel }
        };
    }

    function generateSectionNumber(level, sectionCount, subsectionCount, lastLevel) {
        let sectionNumber = '';
        let newSectionCount = sectionCount;
        let newSubsectionCount = subsectionCount;
        let newLastLevel = lastLevel;

        if (level === 2) {
            sectionNumber = `${sectionCount}. `;
            newSubsectionCount = 1;
            newSectionCount++;
            newLastLevel = 2;
        } else if (level === 3) {
            sectionNumber = `${sectionCount - 1}.${subsectionCount}. `;
            newSubsectionCount++;
            newLastLevel = 3;
        }

        return {
            sectionNumber,
            newSectionCount,
            newSubsectionCount,
            newLastLevel
        };
    }

    function createTOCItem(header, level, sectionNumber) {
        const item = document.createElement('li');
        const link = document.createElement('a');
        
        link.href = `#${header.id}`;
        link.textContent = sectionNumber + header.textContent;
        link.className = 'text-gray-700 hover:text-gray-900 hover:underline block';

        // Add indentation based on header level
        const indent = level - 2;
        item.style.paddingLeft = `${indent * 1}rem`;
        item.appendChild(link);

        return item;
    }

    function insertTOC(article, tocContainer) {
        const header = article.querySelector('header');
        if (header) {
            header.parentNode.insertBefore(tocContainer, header.nextSibling);
        } else {
            article.insertBefore(tocContainer, article.firstChild);
        }
    }
</script>
<script>
    const backgrounds = [
        '/img/background/background.png',
        '/img/background/background2.png',
        '/img/background/background3.png'
    ];
    const randomBackground = backgrounds[Math.floor(Math.random() * backgrounds.length)];
    document.body.style.backgroundImage = `url('${randomBackground}')`;
    document.body.style.backgroundRepeat = 'repeat';
</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const dropdownToggle = document.querySelector('.dropdown-toggle');
        const dropdownMenu = document.querySelector('.dropdown-menu');

        if (!dropdownToggle || !dropdownMenu) {
            console.error('Dropdown elements not found');
            return;
        }

        dropdownToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });

        // Close the dropdown if the user clicks outside of it
        window.addEventListener('click', function(event) {
            if (!event.target.matches('.dropdown-toggle')) {
                if (dropdownMenu.classList.contains('show')) {
                    dropdownMenu.classList.remove('show');
                }
            }
        });

        // Handle all links in the dropdown menu
        document.querySelectorAll('.dropdown-menu a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                dropdownMenu.classList.remove('show');

                const href = this.getAttribute('href');
                
                // Check if it's an external link or the feed.xml
                if (href.startsWith('http') || href.startsWith('https') || href === '/feed.xml') {
                    window.open(href, '_blank');
                    return;
                }

                // Check if it's the home or archive link
                if (href === '/' || href === '/archive.html') {
                    window.location.href = href;
                    return;
                }

                const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html';
                
                if (isHomePage && href.includes('#')) {
                    // If on home page and it's a section link, smooth scroll
                    const targetId = href.split('#')[1];
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                } else {
                    // If on another page or it's not a section link, navigate to the page
                    window.location.href = href;
                }
            });
        });
    });

    // Function to scroll to section after page load
    function scrollToSection() {
        const hash = window.location.hash;
        if (hash) {
            const targetElement = document.quefrySelector(hash);
            if (targetElement) {
                setTimeout(() => {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }
    }

    // Call scrollToSection after page load
    window.addEventListener('load', scrollToSection);
</script>

</body>
</html>